<style>
</style>

<script>
chrome.tabs.getSelected(undefined, function (tab) { 
    document.forms["link"].url.value = tab.url;
    document.forms["link"].title.value = tab.title;
})

function get_link_representation() {
    return ("<link>" + 
            "<url>" + document.forms["link"].url.value + "</url>" + 
            "<title>" + document.forms["link"].title.value + "</title>" + 
            "<notes>" + document.forms["link"].notes.value + "</notes>" + 
            "<tags>" + document.forms["link"].tags.value + "</tags>" + 
            "</link>");
}

function message(str) {
    document.getElementById("message").innerHTML = str;
}

function save_link() {
    req = new XMLHttpRequest();
    req.onreadystatechange = function() {
        /* TODO */
        if (req.readyState == 4) {
            message("Returned " + req.status);
        }
        else {
            message("Sending...");
        }
    }
    try {
        req.open(
            "POST",
            /* TODO */
            "http://localhost:8080/user/foo/links/",
            true);
        req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        req.send("input=" + get_link_representation());
    }
    catch (err) {
        alert("" + err);
    }
    //window.close();
}
</script>

<div id="message"></div>
<form name="link" action="#" method="post">
  <label>URL: <input type="text" id="url"/></label><br/>
  <label>Title: <input type="text" id="title"/></label><br/>
  <label>Notes: <textarea id="notes"></textarea></label><br/>
  <label>Tags: <input type="text" id="tags"/></label><br/>
  <input type="submit" value="Save" onclick="save_link();"/>
</form>
